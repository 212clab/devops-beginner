

MSA 환경에서 api-service 의 서비스들 뿐 아니라
Saga Orchestrator나 CQRS의 Command/Query 서비스를 별도의 서비스로 만듬.
관심사의 분리(Separation of Concerns) 원칙에 따라..


NAME              ENDPOINTS                                      AGE
command-service   10.244.0.42:80,10.244.0.43:80                  45m
event-store-api   10.244.0.47:80                                 45m
order-service                                                    45m
payment-service   10.244.0.37:80,10.244.0.39:80                  45m
query-service     10.244.0.44:80,10.244.0.45:80,10.244.0.46:80   45m

---------

1. Saga 패턴: 분산 트랜잭션 관리 🤝
Saga 패턴은 여러 개의 마이크로서비스에 걸친 비즈니스 트랜잭션의 **데이터 일관성(Data Consistency)**을 보장하기 위한 패턴입니다.

문제: 모놀리식 아키텍처에서는 단일 데이터베이스를 사용해 ACID 트랜잭션을 보장했지만, 마이크로서비스에서는 서비스마다 DB가 분리되므로(분산됨) 단일 트랜잭션을 만들 수 없습니다.


Saga의 역할: 여러 개의 **로컬 트랜잭션(Local Transaction)**을 순차적으로 실행하고, 만약 중간에 어느 하나의 트랜잭션이라도 실패하면 이전에 성공했던 모든 트랜잭션을 **보상 트랜잭션(Compensation Transaction)**을 통해 되돌려(롤백) 데이터 일관성을 유지합니다.

구현 방식:
Orchestration (오케스트레이션): 중앙 집중식 Saga Orchestrator가 각 서비스에게 명령을 내리고 상태를 관리합니다. (실습 자료의 문제 상황 1이 이 방식일 가능성이 높습니다.)
Choreography (코레오그래피): 각 서비스가 이벤트를 발행하고 다른 서비스가 이를 구독하여 연쇄적으로 트랜잭션을 진행합니다.


2. CQRS (Command Query Responsibility Segregation) 패턴: 읽기/쓰기 분리 📖✍️ 
"읽기와 쓰기는 근본적으로 다르다"(*)


CQRS 패턴은 데이터를 변경(쓰기)하는 Command 작업과 데이터를 조회(읽기)하는 Query 작업을 분리하는 패턴입니다.

문제: 복잡한 시스템에서는 쓰기 작업(주문 생성)의 요구사항과 읽기 작업(상품 조회)의 요구사항(성능, 모델)이 매우 다릅니다. 하나의 DB로 두 가지를 모두 처리하면 병목이 발생하고 성능 최적화가 어렵습니다.

CQRS의 역할:
Command Service: 쓰기 전용 모델과 DB를 사용하며, 데이터를 변경하는 작업(Create, Update, Delete)을 처리합니다.

Query Service: 읽기 전용 모델과 DB를 사용하며, 사용자에게 빠르고 최적화된 조회 작업(Select)을 제공합니다.

특징: 쓰기와 읽기 서비스가 분리되면서 데이터 동기화(Synchronization) 문제가 발생할 수 있으며, 실습 자료의 문제 상황 2에서 이 동기화 문제가 언급됩니다.


3. Event Sourcing 패턴: 모든 변화의 기록 📝
Event Sourcing 패턴은 애플리케이션의 현재 상태를 최종 결과로 저장하는 대신, **상태를 변경시킨 모든 일련의 이벤트(Event)**를 순서대로 Event Store에 저장하는 패턴입니다.

문제: 일반적인 DB는 최종 상태만 저장하기 때문에, 어떤 일이 왜 일어났는지 추적하기 어렵고 과거 시점으로 돌아가서 상태를 재생하기 어렵습니다.

Event Sourcing의 역할:
Event Store: 데이터베이스가 아닌, 모든 이벤트가 기록되는 추가 전용(Append-only) 이벤트 저장소입니다.

상태 복원: 현재 상태가 필요할 때는 Event Store에 저장된 **모든 이벤트를 재생(Replay)**하여 상태를 만듭니다.

특징: 강력한 감사(Audit) 기능과 함께 CQRS 패턴과 결합되어 **프로젝션(Projection)**을 만듭니다. 프로젝션은 이벤트 스트림을 기반으로 읽기 전용 모델을 업데이트하는 작업입니다. 실습 자료의 문제 상황 3은 이벤트 손실이나 처리 중단과 관련되어 있습니다